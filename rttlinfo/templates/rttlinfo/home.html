{% extends 'rttlinfo/base_blti.html' %}

{% load static %}

{% block content %}
<div class="canvas-rttlinfo-container">

  <div class="container-fluid mt-4">

    <div class="row">
      <div class="col">
        <h1 class="h2 mb-3" id="uw_rttlinfo_header">
          UW-IT JupyterHub for Teaching and Learning
        </h1>

        <div class="p-3 mx-3 mb-5 rounded" style="background: #f4f2ea;">
          <p class="lead">
            JupyterHub for Teaching gives users access to Jupyter Notebook environments (computational environments and resources) without the hassle of installation and maintenance tasks. Instructors can make individual workspaces available via JupyterHub to students using shared resources, which can be managed efficiently by system administrators.
          </p>
          <div class="text-center">
            <a class="btn btn-primary" href="https://uwconnect.uw.edu/it?id=kb_article_view&sysparm_article=KB0034609" target="_blank">Learn more</a>
          </div>
        </div>
      </div>
    </div>

    <div class="row mb-5">
      <div class="col-md-12">
        <div class="card">
          <div class="card-header">
            <h2 class="h4 mb-0">JupyterHub status for {{ course_long_name }}</h2>
          </div>
          <div class="card-body">
            <div class="row">
              <div class="col-md-8">
                <p class="lead">
                  {% if rttl_hub_exists and rttl_hub_deployed %}
                    A JupyterHub is available for this course. You can access it now!
                  {% elif rttl_hub_exists and rttl_hub_status == 'requested' %}
                    A JupyterHub has been requested for this course.
                  {% else %}
                    No JupyterHub has been requested for this course yet.
                  {% endif %}
                </p>
                
                {% if rttl_hub_exists %}
                <div class="card mb-3">
                  <div class="card-header">
                    <h3 class="h5 mb-0">Hub Details</h3>
                  </div>
                  <ul class="list-group list-group-flush">
                    <li class="list-group-item">
                      <strong>Status:</strong> {{ rttl_hub_status }}
                    </li>
                    {% if rttl_hub_status_message %}
                    <li class="list-group-item">
                      <strong>Message:</strong> {{ rttl_hub_status_message }}
                    </li>
                    {% endif %}
                    {% if rttl_hub_url and rttl_hub_deployed %}
                    <li class="list-group-item">
                      <strong>URL:</strong> <a href="{{ rttl_hub_url }}" target="_blank" class="d-inline-block">{{ rttl_hub_url }}</a>
                    </li>
                    {% endif %}
                  </ul>
                </div>
                {% endif %}
              </div>
              <div class="col-md-4">
                <div class="card">
                  <div class="card-header">
                    <h3 class="h5 mb-0">Actions</h3>
                  </div>
                  <div class="card-body">
                    {% if rttl_hub_exists and rttl_hub_deployed %}
                      <!-- Hub exists and is deployed -->
                      <a href="{{ rttl_hub_url }}" class="btn btn-primary btn-block mb-2" target="_blank">Launch JupyterHub</a>
                      {% if is_instructor or is_admin or is_ta %}
                        <!-- Role check -->
                        <!-- Note: being in these groups does not guarantee Hub admin access - refactor? -->
                        <a href="{{ rttl_hub_url }}/hub/admin" class="btn btn-primary btn-block mb-2" target="_blank">Launch JupyterHub Admin interface</a>
                        <a href={% url 'hub-manage' %}?course_sis_id={{ course_sis_id }} class="btn btn-primary btn-block mb-2" target="_self">Manage Hub Request</a>
                      {% endif %}
                    {% elif rttl_hub_exists and rttl_hub_status == 'archived' %}
                      <!-- Hub exists and is archived -->
                      <button class="btn btn-secondary btn-block mb-2" disabled>Hub has been archived</button>
                    {% elif rttl_hub_exists and rttl_hub_status == 'requested' %}
                      <!-- Hub request has been made and is pending -->
                      {% if is_instructor or is_admin or is_ta %}
                        <!-- Role check -->
                        <a href={% url 'hub-manage' %}?course_sis_id={{ course_sis_id }} class="btn btn-primary btn-block mb-2" target="_self">Manage Hub Request</a>
                      {% else %}
                        <button class="btn btn-secondary btn-block mb-2" disabled>Request Pending</button>
                      {% endif %}
                    {% else %}
                      <!-- Hub does not exist and no request found -->
                      {% if is_instructor or is_admin or is_ta %}
                        <!-- Role check -->
                        <a href={% url 'hub-request' %} class="btn btn-primary btn-block mb-2" target="_self">Request a JupyterHub</a>
                      {% else %}
                        <!-- TODO: workflow for students suggesting a Hub -->
                        <a href={% url 'hub-student-request' %}?course_sis_id={{ course_sis_id }} class="btn btn-primary btn-block mb-2" target="_self">Vote for a JupyterHub</a>
                        {% endif %}
                    {% endif %}
                      <a href="https://uwconnect.uw.edu/it?id=kb_article_view&sysparm_article=KB0034609" class="btn btn-outline-secondary btn-block" target="_blank">View Documentation</a>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}